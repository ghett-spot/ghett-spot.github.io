<!DOCTYPE html>
<html>
<head>
	<title>three</title>
	<link rel='stylesheet' type='text/css' href='assets/css/style.css'>
	<script src="https://unpkg.com/vue@3"></script>
</head>
<body>
<div id='app'>
	<div id='wrapper'>
		<svg viewBox='-450 1100 2500 1350' preserveAspectRatio='xMidYMax meet'>
			<g v-for='descent in treeData'>
				<path v-bind:d='descent.branches'/>
				<g class='icons'>
					<image width='120' v-for='(icon, i) in descent.icons' v-bind:href='"assets/images/treeIcons/"+icon+".png"' v-bind:x='descent.startPos[0]+200*i' v-bind:y='descent.startPos[1]' @click='openBio(icon)'/>
				</g>
			</g>
		</svg>
	</div>
	<div id='widget'>
		<svg viewBox='0 -10 85 85' preserveAspectRatio='xMidYMid meet'>
			<path id='widgetArrowsField' transform-origin='39.7 257.3' d='M 26.5,0 V 4.7 C 21.9,7.7 19.8,8.7 14.3,14.2 9.2,19.1 7.7,21.8 4.7,26.5 H 0 C 0,23.6 0.8,11 3.7,3.7 9.3,1.5 19.7,0 26.5,0 Z M 9.4,5.2 C 8.1,5.2 6.9,5.7 6.3,6.3 5.7,6.8 5.2,8.2 5.2,9.4 c 0,1 0.3,2.3 1,3.1 0.5,0.4 1.7,1.1 3.1,1 1.1,0 2.4,-0.4 3.1,-1 0.5,-0.5 1.1,-1.9 1,-3.1 C 13.5,8.1 13,6.8 12.5,6.3 11.9,5.8 10.7,5.2 9.4,5.2 Z M 6.7,9.9 v -1.1 h 5.3 v 1.1 z M 69.5,6.7 h 1.1 v 2.1 h 2.1 v 1.1 h -2.1 v 2.1 h -1.1 V 9.9 h -2.1 v -1.1 h 2.1 z M 5.3,39.7 c 3.1,7 9.5,14.4 12.4,17.6 l 5.2,-5.2 c -2.1,-3.8 -3.2,-8 -3.2,-12.4 0,-4.3 1.1,-8.6 3.2,-12.4 L 17.7,22.1 C 14.8,25.3 8.4,32.8 5.3,39.7 Z m 68.8,0 c -3.1,6.9 -9.5,14.4 -12.4,17.6 l -5.2,-5.2 c 2.1,-3.8 3.2,-8 3.2,-12.4 0,-4.3 -1.1,-8.6 -3.2,-12.4 l 5.2,-5.2 c 2.9,3.1 9.3,10.6 12.4,17.6 z M 52.9,0 v 4.7 c 4.6,3.0 6.7,4.1 12.2,9.6 5,4.9 6.6,7.6 9.6,12.2 h 4.7 C 79.5,23.6 78.6,10.9 75.7,3.7 70.1,1.5 59.7,0 53,0 Z m 17.1,5.2 c 1.3,0 2.4,0.5 3.1,1 0.5,0.6 1.1,1.9 1,3.1 0,1 -0.3,2.3 -1,3.1 -0.5,0.4 -1.7,1.1 -3.1,1 -1.1,0 -2.4,-0.4 -3.1,-1 -0.5,-0.5 -1.1,-1.9 -1,-3.1 0,-1.3 0.5,-2.5 1,-3.1 0.5,-0.5 1.8,-1.1 3.1,-1.1 z M 39.7,74.1 C 32.7,71 25.3,64.6 22.1,61.7 l 5.2,-5.2 c 3.8,2.1 8,3.2 12.4,3.2 4.3,0 8.6,-1.1 12.4,-3.2 l 5.2,5.2 C 54.1,64.6 46.6,71 39.7,74.1 Z M 39.7,26.1 c -4.4,0 -8.4,1.9 -10.2,3.4 -1.7,1.9 -3.5,6.1 -3.4,10.2 -0.1,4.1 1.8,8.4 3.4,10.2 2.3,2.0 6.6,3.5 10.2,3.4 4.5,0.1 8.7,-2 10.2,-3.4 2.3,-2.8 3.5,-7.1 3.4,-10.2 0.1,-3.8 -1.7,-8.3 -3.4,-10.2 C 47.7,27.7 43.8,26.1 39.7,26.1 Z m 0,4.1 c 1.9,0.9 4,2.6 4.9,3.4 l -1.4,1.4 c -1,-0.6 -2.2,-0.9 -3.4,-0.9 -1.2,0 -2.4,0.3 -3.4,0.9 l -1.4,-1.4 c 0.9,-0.8 2.9,-2.6 4.9,-3.4 z m -6.1,4.7 1.4,1.4 c -0.6,1 -0.9,2.2 -0.9,3.4 0,1.2 0.3,2.4 0.9,3.4 l -1.4,1.4 c -0.8,-0.9 -2.6,-3 -3.4,-4.9 0.9,-1.9 2.6,-4 3.4,-4.9 z m 12.2,0 c 0.8,0.9 2.6,2.9 3.4,4.9 -0.9,1.9 -2.6,4 -3.4,4.9 l -1.4,-1.4 c 0.6,-1 0.9,-2.2 0.9,-3.4 -5.1e-4,-1.2 -0.3,-2.4 -0.9,-3.4 z M 39.7,37.8 c 0.6,0 1.1,0.2 1.4,0.5 0.2,0.3 0.5,0.9 0.5,1.4 0,0.4 -0.2,1 -0.5,1.4 -0.2,0.2 -0.8,0.5 -1.4,0.5 -0.5,0 -1.1,-0.2 -1.4,-0.5 -0.2,-0.2 -0.5,-0.8 -0.5,-1.4 0,-0.6 0.2,-1.1 0.5,-1.4 0.3,-0.2 0.8,-0.5 1.4,-0.5 z m -3.4,6.5 c 1,0.6 2.2,0.9 3.4,0.9 1.2,-5.1e-4 2.4,-0.3 3.4,-0.9 l 1.4,1.4 c -0.9,0.8 -2.9,2.6 -4.9,3.4 -1.9,-0.9 -4,-2.6 -4.9,-3.4 z M 39.7,5.3 C 32.8,8.4 25.3,14.8 22.13,17.7 l 5.2,5.2 c 3.8,-2.1 8,-3.2 12.4,-3.2 4.3,0 8.6,1.1 12.4,3.2 l 5.2,-5.2 C 54.1,14.8 46.6,8.4 39.7,5.3 Z' fill='#42386b'/>

			<g id='widgetSwitcher'>
				<path id='switcherArrow' d='m 39.7,26.1 c -4.4,0 -8.4,1.9 -10.2,3.4 -1.7,1.9 -3.5,6.1 -3.4,10.2 -0.1,4.1 1.8,8.4 3.4,10.2 2.3,2 6.6,3.5 10.2,3.4 4.5,0.1 8.7,-2 10.2,-3.4 2.3,-2.8 3.5,-7 3.4,-10.2 0.1,-3.8 -1.7,-8.3 -3.4,-10.2 C 47.7,27.7 43.8,26.1 39.7,26.1 Z m 0,4.1 c 1.9,0.9 4,2.6 4.9,3.4 l -1.4,1.4 c -1,-0.6 -2.2,-0.9 -3.4,-0.9 -1.2,0 -2.4,0.3 -3.4,0.9 l -1.4,-1.4 c 0.9,-0.8 2.9,-2.6 4.9,-3.4 z m -6.1,4.7 1.4,1.4 c -0.6,1 -0.9,2.2 -0.9,3.4 0,1.2 0.3,2.4 0.9,3.4 l -1.4,1.4 c -0.8,-0.9 -2.6,-2.9 -3.4,-4.9 0.9,-1.9 2.6,-4 3.4,-4.9 z m 12.2,0 c 0.8,0.9 2.6,2.9 3.4,4.9 -0.9,1.9 -2.6,4 -3.4,4.9 l -1.4,-1.4 c 0.6,-1 0.9,-2.2 0.9,-3.4 -5.1e-4,-1.2 -0.3,-2.4 -0.9,-3.4 z M 39.7,37.8 c 0.6,0 1.1,0.2 1.4,0.5 0.2,0.3 0.5,0.7 0.5,1.4 0,0.4 -0.2,1 -0.5,1.4 -0.2,0.2 -0.8,0.5 -1.4,0.5 -0.5,0 -1.1,-0.2 -1.4,-0.5 -0.2,-0.2 -0.5,-0.8 -0.5,-1.4 0,-0.6 0.2,-1.1 0.5,-1.4 0.2,-0.2 0.8,-0.5 1.4,-0.5 z m -3.4,6.5 c 1,0.6 2.2,0.9 3.4,0.9 1.2,-5.1e-4 2.4,-0.3 3.4,-0.9 l 1.4,1.4 c -0.9,0.8 -2.9,2.6 -4.9,3.4 -1.9,-0.9 -4,-2.6 -4.9,-3.4 z'/>
			</g>

			<g id='actionThumbs'>
				<path id='switchWidgetCondition' d='m 39.7,26.1 c -4.4,0 -8.4,1.9 -10.2,3.4 -1.7,1.9 -3.5,6.1 -3.4,10.2 -0.1,4.1 1.8,8.4 3.4,10.2 2.3,2 6.6,3.5 10.2,3.4 4.5,0 8.7,-2 10.2,-3.4 2.3,-2.8 3.5,-7.1 3.4,-10.2 0.1,-3.8 -1.7,-8.3 -3.4,-10.2 -2.2,-1.8 -6.1,-3.4 -10.2,-3.4 z'/>
				<path id='zoomOut' d='m 26.5,1.4e-4 v 4.7 c -4.6,3 -6.7,4.1 -12.2,9.6 -5,4.9 -6.6,7.6 -9.6,12.2 H 0 C -0.1,23.6 0.8,10.9 3.7,3.7 9.3,1.5 19.7,0 26.5,1.4e-4 Z'/>
				<use id='zoomIn' href='#zoomOut' transform-origin='39.7 39.7' transform='rotate(90)'/>
				<path id='moveLeft' d='m 5.3,39.7 c 3.1,6.9 9.5,14.4 12.4,17.6 l 5.2,-5.2 c -2.1,-3.8 -3.2,-8 -3.2,-12.4 0,-4.3 1.1,-8.6 3.2,-12.4 l -5.2,-5.2 c -2.9,3.1 -9.3,10.6 -12.4,17.6 z'/>
				<use id='moveTop' href='#moveLeft' transform-origin='39.7 39.7' transform='rotate(90)'/>
				<use id='moveRight' href='#moveLeft' transform-origin='39.7 39.7' transform='rotate(180)'/>
				<use id='moveBottom' href='#moveLeft' transform-origin='39.7 39.7' transform='rotate(270)'/>
			</g>
		</svg> 
	</div>
	<div id='overlay' @click='closeBio()'></div>
	<div id='modal' v-if='currentPerson!=null'>
		<div id='cross' @click='closeBio()'>
			<svg viewBox='-10 -10 70 70' preserveAspectRatio='xMidYMid meet'>
				<path d='M 0,0 l 50,50 M 50,0 l -50,50'/>
			</svg>
		</div>
		<div id='imageWrapper'>
			<img :src='"assets/images/treeIcons/"+currentPerson+".png"' width='120px'/>	
		</div>
		<div id='name'>
			<h1 v-if='bios[currentPerson].surname!=null'>{{ bios[currentPerson].surname }} {{ bios[currentPerson].name }} {{ bios[currentPerson].middlename }}</h1>
		</div>
		<div id='birth'>
			<p v-if='bios[currentPerson].birth!=null'>{{ bios[currentPerson].birth }} {{ bios[currentPerson].birthPlace }}</p>
		</div>
		<div id='death'>
			<p v-if='bios[currentPerson].deathPlace!=null'> {{ bios[currentPerson].death }} {{ bios[currentPerson].deathPlace }}</p>
		</div>
		<div id='education' v-if='bios[currentPerson].education!=null'>
			<p>Образование: {{ bios[currentPerson].education }}</p>
		</div>
		<div id='work' v-if='bios[currentPerson].profession!=null'>
			<p>Профессии: {{ bios[currentPerson].profession }}</p>
		</div>
		<div id='hobbie' v-if='bios[currentPerson].hobbie!=null'>
			<p>Увлечения: {{ bios[currentPerson].hobbie }}</p>
		</div>
		<div id='bio' v-if='bios[currentPerson].bio!=null'>
			<p>{{ bios[currentPerson].bio }}</p>
		</div>
	</div>
	<div id='modal' v-else></div>
</div>
<script type='text/javascript' src='assets/data/bios.js'></script>  
<script>
var preventModal=false;

const app = {
	data() {
		return {
			treeData: treeData,
			currentPerson: 'ivanitskayaAnna',
			bios: personsData
		}
	},
	methods: {
		openBio(id) {
			if (preventModal==false) {
				this.currentPerson = id;
				document.getElementById('overlay').style.display='block';
				document.getElementById('modal').style.display='flex';
			}
		},
		closeBio() {
			document.getElementById('overlay').style.display='none';
			document.getElementById('modal').style.display='none';
		}
	}
};

Vue.createApp(app).mount('#app');

var tree = document.getElementById('wrapper');
var root_style = getComputedStyle(document.documentElement);
var overlay = document.getElementById('overlay');
window.addEventListener('wheel',e => {
	if (overlay.style.display!='block') {
		let tree_scale = parseFloat(root_style.getPropertyValue('--tree-scale')),
				tree_x_pos = parseFloat(root_style.getPropertyValue('--tree-x-pos')),
				tree_y_pos = parseFloat(root_style.getPropertyValue('--tree-y-pos')),
				win_width = window.innerWidth,
				win_height = window.innerHeight,
				cursor_x = e.clientX,
				cursor_y = e.clientY;
		if (e.deltaY<0&&tree_scale<=6) {
			document.documentElement.style.setProperty('--tree-x-pos', (tree_x_pos-(cursor_x-win_width/2)/10));
			document.documentElement.style.setProperty('--tree-y-pos', (tree_y_pos-(cursor_y-win_height/2)/10));
			document.documentElement.style.setProperty('--tree-scale', tree_scale+.1);
		}
		else if (e.deltaY>0&&tree_scale>0) {
			document.documentElement.style.setProperty('--tree-scale', tree_scale-.1);
		}
	}
});

window.addEventListener('mousedown',e => {
	let cursor_x_start = e.clientX,
			cursor_y_start = e.clientY;
			tree_x_pos = parseFloat(root_style.getPropertyValue('--tree-x-pos')),
			tree_y_pos = parseFloat(root_style.getPropertyValue('--tree-y-pos'));
	window.onmousemove = (e) => {
		document.documentElement.style.cursor='move';
		preventModal=true;
		let translation_x = e.clientX-cursor_x_start,
				translation_y = e.clientY-cursor_y_start;
		document.documentElement.style.setProperty('--tree-x-pos', (tree_x_pos+translation_x));
		document.documentElement.style.setProperty('--tree-y-pos', (tree_y_pos+translation_y));
	};
});

window.addEventListener('mouseup',e => {
	window.onmousemove = null;
	setTimeout(()=>{preventModal=false;},400);
	document.documentElement.style.cursor='default';
});

const widgetAction = (id) => {
	let tree_scale = parseFloat(root_style.getPropertyValue('--tree-scale')),
			tree_x_pos = parseFloat(root_style.getPropertyValue('--tree-x-pos')),
			tree_y_pos = parseFloat(root_style.getPropertyValue('--tree-y-pos'));
	switch(id) {
		case 'switchWidgetCondition':
			document.getElementById('widgetSwitcher').style.display='none';
			break;
		case 'zoomOut':
			if (tree_scale>.4){
				document.documentElement.style.setProperty('--tree-scale', tree_scale-.2);
			}
			break;
		case 'zoomIn':
			if (tree_scale<5){
				document.documentElement.style.setProperty('--tree-scale', tree_scale+.2);
			}
			break;
		case 'moveLeft':
			document.documentElement.style.setProperty('--tree-x-pos', (tree_x_pos+200/Math.floor(tree_scale)));
			break;
		case 'moveTop':
			document.documentElement.style.setProperty('--tree-y-pos', (tree_y_pos+200/Math.floor(tree_scale)));
			break;
		case 'moveRight':
			document.documentElement.style.setProperty('--tree-x-pos', (tree_x_pos-200/Math.floor(tree_scale)));
			break;
		case 'moveBottom':
			document.documentElement.style.setProperty('--tree-y-pos', (tree_y_pos-200/Math.floor(tree_scale)));
			break;
		default:
			console.log('hm...something wrong...',id);
			break;
	}
}


document.getElementById('actionThumbs').addEventListener('click',(e)=>{
	widgetAction(e.target.id);
},false);
window.addEventListener('keydown',(e)=>{
  switch(e.keyCode) {
		case 38:
			widgetAction('moveTop');
			break;
		case 40:
			widgetAction('moveBottom');
			break;
		case 37:
			widgetAction('moveLeft');
			break;
		case 39:
			widgetAction('moveRight');
			break;
		case 32:
			widgetAction('zoomIn');
			break;
		case 107:
			widgetAction('zoomIn');
			break;
		case 109:
			widgetAction('zoomOut');
			break;
		default:
			console.log('hm...something wrong...',e.keyCode);
			break;
	}
},false);

</script>
</body>
</html>